---
title: "COVID-19 in Malaysia"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
    orientation: rows
    navbar:
          - {title: "About me", icon: "fa-github", href: "https://github.com/fyii200", align: left}
    social: menu
    fig_mobile: FALSE
date: <span style="font-size:0.8em;">`r format(Sys.Date(), '%d %b %Y')` </span>
---

```{r setup, include=FALSE}
## load relevant functions, packages ##
# install.packages("waffle", repos = "https://cinc.rud.is")
# install.packages('dygraph')
# install.packages('dplyr)
library(RColorBrewer)
library(highcharter)
library(dplyr)
library(waffle)
library(xts)

### DAILY CASES, TESTS, DEATHS, etc. ###
## read raw data (worldwide) and configure data frame named 'mys'
world     <- read.csv('https://covid.ourworldindata.org/data/owid-covid-data.csv')
mys       <- world[which(world$iso_code == 'MYS'), ]
mys$date  <- as.Date(mys$date)

### VACCINATION DATA ###
# data    <- 'https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/country_data/Malaysia.csv'
data      <- 'data/vaccine.csv'
d         <- read.csv(data); d<-d[,-1]
d$date    <- as.Date(d$date, '%d/%m/%Y')

## source all functions & computations ##
source('computations.R')
```


Comparisons {.storyboard data-icon="fa-globe-asia"}
=========================================

### <span style="font-size:1.3em;"> **New cases per million | Choropleth map ** </span>
```{r echo=FALSE, fig.height=6, fig.width=7, warning=FALSE}
# Plot map (new cases per million)
plot_map_cases_per_million(dataset = mapdata,
                           mapsource = "custom/world-highres" )
```

***
How do we compare to other countries in terms of daily number of cases per million population? Hover your cursor over or tap a country of interest to see the data corresponding to that country. Remember you can zoom in and out of the map. Panning will be enabled when the map is zoomed in.


### <span style="font-size:1.3em;"> **New cases per million | Bubble plot ** </span>
```{r echo=FALSE, fig.height=6, fig.width=7, warning=FALSE}
plot_map_cases_per_million <- function(dataset, mapsource, covid_data, covid_data_name){
  min_cols <- brewer.pal(9, "Greens")
  max_cols <- brewer.pal(9, "Reds")
  
  plot_map <-
    hcmap(mapsource,  showInLegend = FALSE,
          data = dataset,
          value = covid_data,
          joinBy = 'name',
          name = covid_data_name,
          minSize = "1%",
          maxSize = "100%"
    ) %>%
    
    hc_colorAxis(minColor = min_cols[2], 
                 maxColor = max_cols[9], 
                 min = 0, max = 500)
  
  map_config(plot_map)
}



unique_country <- unique(world$location)

vac <- data.frame(name = unique_country, 
                  people_vaccinated_per_hundred = 0, 
                  people_fully_vaccinated_per_hundred = 0)

for(i in 1:length(unique_country) ) {
  
  a <- subset(world, location == unique_country[i] )
  
  vac[i, 2:3] <- c( max(a$people_vaccinated_per_hundred, na.rm = T),
                   max(a$people_fully_vaccinated_per_hundred, na.rm = T)
                  )
}

mapdata <- merge(mapdata, vac, by = 'name')

mapdata <- mapdata[which(mapdata$people_fully_vaccinated_per_hundred.y >= 0), ]

plot_map_cases_per_million(mapdata, "custom/world-highres", 'people_fully_vaccinated_per_hundred.y', 'Fully vaccinated')
```

***
Certain countries (including Malaysia) are color-coded, while others are grey. Each bubble represents a country, with its radius corresponding to the size of that country. Hover your cursor over or tap the bubbles to explore the number of daily cases per million population in different countries. You can also highlight the colour-coded countries by clicking on or tapping the legend text associated with each country.







